<form class="form-horizontal well" name="cliente" id="nuevoClienteForm" action="@{ClientesController.nuevoCliente()}" method="post">
    <fieldset>
        <legend>Registro de Nuevo Cliente &nbsp;<i class="fa fa-user"></i></legend>
        <div class="row">
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="nombres">Nombres :</label>
                <div class="col-md-8">
                    <input id="nombres" name="cliente.nombres" type="text" placeholder="Nombres" value="${flash['cliente.nombres']}" class="form-control input-md">
                   <strong><span class="text-danger">#{error 'cliente.nombres'/}</span></strong>
                </div>
            </div>
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="rut">R.U.T :</label>

                <div class="col-md-8">
                    <input id="rut" name="cliente.rut" type="text" placeholder="Rut" class="form-control input-md" value="${flash['cliente.rut']}">
                    <strong><span class="text-danger">#{error 'cliente.rut'/}</span></strong>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="apellidoMaterno">Apellido Materno:</label>

                <div class="col-md-8">
                    <input id="apellidoMaterno" name="cliente.apellidoMaterno" type="text" placeholder="Apellido Materno"
                           class="form-control input-md" value="${flash['cliente.apellidoMaterno']}">
                    <strong><span class="text-danger">#{error 'cliente.apellidoMaterno'/}</span></strong>

                </div>
            </div>
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="apellidoPaterno">Apellido Paterno: </label>

                <div class="col-md-8">
                    <input id="apellidoPaterno" name="cliente.apellidoPaterno" type="text" placeholder="Apellido Paterno"
                           class="form-control input-md" value="${flash['cliente.apellidoPaterno']}">
                    <strong><span class="text-danger">#{error 'cliente.apellidoPaterno'/}</span></strong>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="fechaNacimiento">Fecha de Nacimiento:</label>

                <div class="col-md-8">
                    <input id="fechaNacimiento" name="fechaNacimiento" type="text" placeholder=""
                           class="form-control input-md datepicker" value="${flash['fechaNacimiento']}">
                    <strong><span class="text-danger">#{error 'fechaNacimiento'/}</span></strong>
                </div>
            </div>
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="sexo">Sexo:</label>

                <div class="col-md-4">
                    <div class="radio">
                        <label for="sexo-0">
                            <input type="radio" name="cliente.genero" id="sexo-0" value="0" checked="checked" ${flash['cliente.genero']} >
                            Masculino
                        </label>
                    </div>
                    <div class="radio">
                        <label for="sexo-1">
                            <input type="radio" name="cliente.genero" id="sexo-1" value="1" ${flash['cliente.genero']}>
                            Femenino
                        </label>
                    </div>
                    <strong><span class="text-danger">#{error 'cliente.genero'/}</span></strong>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="region">Region:</label>
                <div class="col-md-8">
                    <select id="region" name="cliente.region" class="form-control" >
                        <option value="">Seleccione..</option>
                        #{list items:regiones, as:'region'}
                            <option value="${region.id}" >${region.nombre}</option>
                        #{/list}
                    </select>
                </div>
            </div>
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="provincia">Provincia:</label>
                <div class="col-md-8">
                    <select id="provincia" name="cliente.provincia"  class="form-control">
                        <option value="" >Seleccione..</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="comuna">Comuna:</label>

                <div class="col-md-8">
                    <select id="comuna" name="cliente.comuna" class="form-control">
                        <option value="">Seleccione..</option>
                    </select>
                    <strong><span class="text-danger">#{error 'cliente.comuna'/}</span></strong>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-9 col-md-pull-1">
                <label class="col-md-4 control-label" for="direccion">Dirección:</label>
                <div class="col-md-8">
                    <input id="direccion" name="cliente.direccion" type="text" placeholder="Dirección" class="form-control input-md" value="${flash['cliente.direccion']}">
                    <strong><span class="text-danger">#{error 'cliente.direccion'/}</span></strong>
                </div>
            </div>
            <div class="col-md-3">
            </div>
        </div>
        <div class="row">
                <div class="form-group col-md-6">
                    <label class="col-md-4 control-label" for="telefono">Telefono:</label>

                    <div class="col-md-8">
                        <input id="telefono" name="cliente.telefono" type="text" placeholder="Telefono" class="form-control input-md" value="${flash['cliente.telefono']}">
                        <strong><span class="text-danger">#{error 'cliente.telefono'/}</span></strong>
                    </div>
                </div>
            <div class="form-group col-md-6">
                <label class="col-md-4 control-label" for="celular">Celular:</label>

                <div class="col-md-8">
                    <input id="celular" name="cliente.celular" type="text" placeholder="Celular" class="form-control input-md" value="${flash['cliente.celular']}">
                    <strong><span class="text-danger">#{error 'cliente.celular'/}</span></strong>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-9 col-md-pull-1">
                <label class="col-md-4 control-label" for="email">E-mail:</label>
                <div class="col-md-8">
                    <input id="email" name="cliente.email" type="text" placeholder="E-mail" class="form-control input-md" value="${flash['cliente.email']}">
                    <strong><span class="text-danger">#{error 'cliente.email'/}</span></strong>
                </div>
            </div>
            <div class="col-md-3">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
            </div>
            <div class="form-group col-md-8 col-md-push-1">
                <label class="col-md-6 control-label" for="cancelar"></label>
                <div class="col-md-6">
                    <button type="button" id="registrar" class="btn btn-success">Guardar <i class="fa fa-check"></i></button>
                </div>
            </div>
        </div>

    </fieldset>
</form>
#{i18n /}
<script type="text/javascript">

    $('#fechaNacimiento').datepicker({
        format: "dd/mm/yyyy",
        endDate: "0",
        language: 'es',
        autoclose: true
    });

    $("#celular,#telefono").keypress(function (e){
        var charCode = (e.which) ? e.which : e.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
    });

    var $clienteForm = $("#nuevoClienteForm");
    $("#registrar").click(function(){
        bootbox.confirm(i18n('nuevoCliente'),function(result){
            $("#nuevoClienteForm ul.errors-fields").remove();
            if(result){
                $.ajax({
                    url : "@{ClientesController.nuevoCliente()}",
                    method: "post",
                    data: $clienteForm.serialize(),
                    success: function(resp){
                        location.href = "/contrato/"+resp;
                    },
                    error :function(resp){
                        console.log(resp);
                        if (resp.status == 400) {
                            $.each(resp.responseJSON.fieldErrors, function(name, errors){
                                var $input = $(":input[name='" + name + "']", $clienteForm);
                                $input.closest("div.form-group").addClass("has-error");
                               var $ul = $("<ul class='errors-fields list-inline'></ul>");
                                $.each(errors,function(i,elem){
                                    var $li = $("<li class='text-danger'/>");
                                    $li.text(elem);
                                    $ul.append($li);
                                });
                                $input.after($ul);
                                console.log(errors);
                            });
                            console.log(resp.responseJSON);
                        }
                    }
                });

            }
        });

    });

    $("#region").change(function(){
       var idRegion = $("#region").val();
       var selectProvincia = $("#provincia");
       var selectComuna = $("#comuna");
        if(idRegion == ''){
            selectProvincia.empty();
            selectComuna.empty();
            selectProvincia.append($('<option>').text("Seleccione..").attr('value', ''));
            selectComuna.append($('<option>').text("Seleccione..").attr('value', ''));
        }
        $.ajax({
            url: "provincias/"+idRegion,
            method: "GET",
            success: function(provincias){
                selectProvincia.empty();
                selectProvincia.append($('<option>').text("Seleccione..").attr('value', ''));
                $.each(provincias,function(k,value){
                    selectProvincia.append($('<option>').text(value.nombre).attr('value', value.id));
                });
            }
        });
    });

    $("#provincia").change(function(){
        var idProvincia = $("#provincia").val();
        var selectComuna = $("#comuna");
        if(idProvincia == ''){
            selectComuna.empty();
            selectComuna.append($('<option>').text("Seleccione..").attr('value', ''));
        }
        $.ajax({
            url: "comunas/"+idProvincia,
            method: "GET",
            success: function(comunas){
                selectComuna.empty();
                $.each(comunas,function(k,value){
                    selectComuna.append($('<option>').text(value.nombre).attr('value',value.id));
                });
            }
        });
    });
    $("#rut").Rut({
        on_error: function(){
            bootbox.alert("Rut no valido",function(){
                $("#rut").val('');
            });
        }
    });

</script>